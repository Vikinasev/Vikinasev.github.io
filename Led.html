<!Doctype html>
<html>
	<head>
		<title>My First Value</title>
		<link rel="stylesheet" href="Led.css">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>

	</head>
	<body>
		<h1><div id="connstatus">Mqtt Not connected.</div></h1>
	</body>
	<script>

		var websocket="a0dcde1a548d471dbb80aa751dbf3c9d.s1.eu.hivemq.cloud";
		var port=8884;
		var user="viktor";
		var pass="ViktorNasev04";
		var buttonState = false;

		function toggleButtonState() {buttonState = !buttonState;}
		//client = new Paho.MQTT.Client(websocket, port, "web_" + parseInt(Math.random() * 100, 10));
		client = new Paho.MQTT.Client(websocket, port, "Deviceid_34534543");
		// set callback handlers
		client.onConnectionLost = onConnectionLost;
		client.onMessageArrived = onMessageArrived;

		var options = {
		useSSL: true,
		userName: user,
		password: pass,
		onSuccess:onConnect,
		onFailure:doFail
		}
		
		// connect the client
		client.connect(options);
		
		// called when the client connects
		function onConnect() {
		document.getElementById("connstatus").innerHTML = "Mqtt Connected";
		console.log("Mqtt Connected");
		client.subscribe("control/led");
		// Добавете event listener за натискането на бутона
		document.getElementById('mqttButton').addEventListener('click', function() {
		toggleButtonState();
		
		var message = new Paho.MQTT.Message(buttonState ? '1' : '0');
		message.destinationName = 'control/led';
		client.send(message);});
		}

		function doFail(e){
		console.log(e);
		}

		// called when the client loses its connection
		function onConnectionLost(responseObject) {

		document.getElementById("connstatus").innerHTML = "Mqtt Not Connected";
	
		if (responseObject.errorCode !== 0) {
		console.log("onConnectionLost:"+responseObject.errorMessage);
			}
		}

		function onMessageArrived(message) {
		console.log("onMessageArrived:"+message.destinationName);
		console.log("message.payloadString:"+message.payloadString);
		}


	</script>

	<div class="text-box">
    <a id="mqttButton" href="#" class="btn btn-white btn-animate">On/Off</a>
	</div>


</html>